---
calendar_date: 2022-7-31
catalog: true
categories:
- Windows
cover:
  image: /cover/cover4.jpeg
date: 2022-07-31 23:43:00
lang: cn
mathjax: false
subtitle: windows设置文件共享，以及全平台如何访问
tags:
- Windows
thumbnail: /img/header_img/lml_bg31.jpg
title: Windows Configuration03 LAN sharing
toc: true
---

在同一个局域网（像是链接同一个wifi的环境）中，设置共享的文件夹或者磁盘，可提升文件分享的效率和速度，特别适用于与女朋友合租、与兄弟合租的情景。



## Win 系统开放共享权限

Windows的设置首先要在控制面板中开启共享功能：

![image-20220801160336296](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/image-20220801160336296.png)

针对专用网络开启

![image-20220801161142132](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/image-20220801161142132.png)

为了信息和数据安全关闭来宾和公用，并开启加密

![image-20220801161340594](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/image-20220801161340594.png)

基于该设置，在访问共享文件夹之时，需要输入账号和密码。

## Win 共享文件夹设置

直接使用默认的共享功能可以方便设置，但是存在可访问父级文件夹的 bug，建议设置好用户后使用。

如果操作得当可以使用高级共享功能来创建更为安全的文件夹共享。

使用高级共享中的设置来定义权限Everyone（是否允许修改等其他权限）

![image-20220801162822427](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/imgs/image-20220801162822427.png)

至此，完成了文件夹和文件的共享设置，使用同样的设置，便可以在LAN中的其他设备访问开放共享的文件夹。

### 共享用户创建

可以在默认的共享设置中设置权限的时候，选择设置新用户，跳过使用 Microsoft 账号，创建本地账号，后面共享链接的时候就可以用该账号登录了。

![image.png](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20230322092927.png)

然后选择管理其他账户 ![image.png](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20230322092954.png)，然后选择添加新用户-> 添加账户即可。

## Linux 共享文件夹设置

设置 Linux 的文件夹共享，安装对应的 Samba 来启动 SMB 文件共享（需要注意的是，这一步安装不能使用远程桌面进行）

![image.png](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20230625181635.png)

设置好对应的文件读写权限，同时使用下列命令设置好允许访问 smb 文件夹的用户：

```bash
sudo smbpasswd -a <username>
```

`<username>` 需要为 linux 的有效用户，设置好 SMB 账号密码即可开启完整的访问服务。

## 各平台访问共享文件夹

### windows 访问

使用以下的方式访问共享文件夹：

```
\\192.168.31.108\\Folder
```

可以使用`\\localhost`在资源管理器中访问《网络》中《我的共享文件夹》，确保当前网络为**专用**的情况下，可以打开另外终端资源管理器中的《网络》来访问当前共享文件夹。

经测试，文件访问和读取的速度较快，在带宽充足的情况下，能够取代 U 盘等进行文件的传输和共享，也能实现视频流的实时播放。

### ios 访问

在默认的文件 APP 中，连接服务器，连接到 pc 的 ip 地址，用指定的账户登录即可。

### mac 访问

在访达中选择前往，然后选择连接服务器，然后选中局域网的 IP 并输入指定的账号密码即可登录。

### Linux 访问

[linux开机挂载文件夹,Linux开机挂载windows共享文件夹_正妻空母加贺桑的博客-CSDN博客](https://blog.csdn.net/weixin_36118049/article/details/116648793)

【交互界面】方法 1：在 File Manager 里面选择 other Location 中的 Connect to Server，连接到 windows 的 SMB 服务器即可。


![image.png](https://picture-bed-001-1310572365.cos.ap-guangzhou.myqcloud.com/3070PC/20230625180602.png)

【推荐】方法 2：使用手动挂载命令，将 windows 的共享文件夹挂载到指定目录下。

```bash
sudo mount -t cifs //192.168.31.201/<share dir> <local-position> -o username='username',password='passwd',vers=2.0
```

【成功】方法 2.1：使用[开机启动脚本](https://www.cnblogs.com/52php/p/5677805.html) `/etc/rc.local` 开机执行上述脚本即可，[Ubuntu 22.04 LTS 不用再自己写rc-local.service了-简易百科 (isolves.com)](https://m.isolves.com/it/rj/czxt/linux/2022-06-17/55976.html) ，原本系统中没有 `rc.local` 文件，但是 Ubuntu 中已经无需自己编写，但是需要新建后赋予其执行权限

```bash
sudo chmod +x /etc/rc.local
```

这里需要注意的是，编写挂载脚本的时候，因为树莓派在刚开机的时候挂载会失败，所以需要引入 sleep 一段时间。具体的操作流程如下：

- 创建脚本文件 `startup.sh` 在任意位置，内容参考手动挂载命令，在这之前添加 sleep。

```bash
sleep 30

# 下面两者选一个用即可
# 选项1 使用方法2.手动挂载命令挂载
sudo mount -t cifs //192.168.31.201/<share dir> <local-position> -o username='username',password='passwd',vers=2.0

# 选项2 使用方法2.3 已经在fstab中加入挂载的命令
sudo mount -a
```

- 在 `rc.local` 的 exit0之前添加调用执行该脚本

```bash
...
...

sudo sh /<path-to-your-script>/startup.sh
exit 0
```

如果失败了可以尝试 chmod +x startup.Sh 修改成可执行。

【成功】方法 2.2：[加入开机启动项](https://www.80tm.com/2022/12/17/ubuntu%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4/)，在 `/etc/init.d` 中编写需要开机启动的脚本，然后执行以下的命令加入开机启动中：

```bash
sudo update-rc.d xxx.sh defaults 90
```

最后一个数字是脚本启动的顺序，数字越大，执行越晚，重启即可完成测试，以下命令可以查看全部服务列表：

```bash
sudo service --status-all
```

卸载启动脚本的方法：

```bash
sudo update-rc.d -f xxx.sh remove
```

【成功一半】方法 2.3：使用自动挂载命令，修改 [fstab](https://www.cnblogs.com/arnoldlu/p/11613842.html)，将以下的命令添加到该文件下面即可生效：

```txt
//192.168.31.201/<share dir> /mnt/windows-share cifs username='username',password='passwd' 0 0 
```

如果要卸载网络共享目录使用以下命令：

```bash
sudo umount <local-postion>
```

可以通过 `df -h` 查看挂载是否成功。

【可选】方法 3: 要进入 smb 的命令操作空间

```bash
# 安装Smbclient
sudo apt-get install smbclinent
```

安装好后，就可以访问共享的文件夹，这样会进入 smb 的命令操作空间

```bash
smbclient --user=share //192.168.31.198/share
```